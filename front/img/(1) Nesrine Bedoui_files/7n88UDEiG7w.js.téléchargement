if (self.CavalryLogger) { CavalryLogger.start_js(["o4EXF"]); }

__d('canUseReactEditor',['UserAgent'],(function a(b,c,d,e,f,g){'use strict';var h=typeof b.getSelection==='function',i=h&&(c('UserAgent').isPlatform('iOS')||c('UserAgent').isPlatform('Linux')||c('UserAgent').isPlatform('Mac OS X')||c('UserAgent').isPlatform('Windows')||c('UserAgent').isPlatform('Chrome OS'))&&(c('UserAgent').isEngine('EdgeHTML >= 12')||c('UserAgent').isEngine('Gecko >= 16')||c('UserAgent').isEngine('Trident >= 5')||c('UserAgent').isEngine('WebKit >= 533.16')&&!c('UserAgent').isBrowser('Mobile Safari < 6'));function j(){return i;}f.exports=j;}),null);
__d('UFIMentionsInput.react',['cx','AddEmojiInputContainer','AddEmojiToEditorStateContainer','Arbiter','BanzaiScuba','Bootloader','DraftEntity','DraftModifier','DOMVector','EditorState','EmojiFormat','Input','Keys','MentionsInput.react','React','ReactDOM','UFIUIEvents','URI','UFIConfig','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createMentionEntity','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('AddEmojiInputContainer').addEmojiInput,j=c('AddEmojiToEditorStateContainer').addEmojiToEditorState,k=null;if(i){k=i(c('MentionsInput.react'));}else k=c('MentionsInput.react');var l=new (c('BanzaiScuba'))('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),m=200,n='ufi_comment_composer',o='ufi_reply_composer',p=c('canUseReactEditor')(),q=c('React').PropTypes;function r(v){var w=v.map(function(x){return {kind:'file',type:x.type,getAsFile:c('emptyFunction').thatReturns(x)};});return {clipboardData:{items:w}};}function s(v){var w=/^image\//;return v.filter(function(x){return w.test(x.type);});}var t=c('React').createClass({displayName:'UFIMentionsInput',propTypes:{onContentChange:q.func,isBroadcasterUFI:q.bool},getInitialState:function v(){var w='',x=[];c('Arbiter').subscribe('Story/delete',function(z){this._clearDocumentState();}.bind(this));if(this.props.initialData){w=this.props.initialData.value||'';x=this.props.initialData.mentions||[];x=x.map(function(z){return babelHelpers['extends']({},z,{entity:{uid:z.uid,weakreference:z.weakreference}});});}var y=c('createEditorStateWithEntities')({text:w,ranges:x,decorator:c('getMentionsInputDecorator')(),entityCreationFn:u});y=c('EditorState').moveSelectionToEnd(y);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:y,mentionsSource:null,mentionableEntries:null,fallbackText:w};},hasEnteredText:function v(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},getText:function v(){var w=this.state.editorState.getCurrentContent();return c('getMentionsTextForContentState')(w);},focus:function v(){this._triggerFullRender(function(){if(p){this.refs.mentionsInput.focus();}else c('ReactDOM').findDOMNode(this.refs.textarea).focus();}.bind(this));},submitComment:function v(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function v(w){this._triggerFullRender(function(){if(p){var x=this.state.editorState,y=x.getSelection(),z=x.getCurrentContent(),aa=y.getStartKey(),ba=y.getStartOffset(),ca=z.getBlockForKey(aa),da;if(ca.getText().substr(ba-1,1).trim().length>0){var ea=c('DraftModifier').replaceText(z,y,' ');y=ea.getSelectionAfter();da=c('DraftModifier').insertText(ea,y,w.getTitle(),x.getCurrentInlineStyle(),c('createMentionEntity')(w));}else da=c('DraftModifier').replaceText(z,y,w.getTitle(),x.getCurrentInlineStyle(),c('createMentionEntity')(w));y=da.getSelectionAfter();da=c('DraftModifier').insertText(da,y,' ');x=c('EditorState').push(x,da,'insert-fragment');x=c('EditorState').forceSelection(x,x.getSelection());this.setState({editorState:x});this.focus();}else{c('ReactDOM').findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+w.title});}else this.setState({fallbackText:w.title});}}.bind(this));},insertEmoticon:function v(w){if(!p){this.setState({fallbackText:this.state.fallbackText+' '+w});return;}var x=this.state.editorState,y=x.getCurrentContent(),z=x.getSelection(),aa=y.getBlockForKey(z.getStartKey()).getText()[z.getStartOffset()-1];if(aa&&aa!==' ')w=' '+w;var ba=y.getBlockForKey(z.getEndKey()).getText()[z.getEndOffset()];if(ba&&ba!==' ')w+=' ';var ca=c('DraftModifier').replaceText(x.getCurrentContent(),x.getSelection(),w);x=c('EditorState').push(x,ca,'insert-characters');x=c('EditorState').forceSelection(x,x.getSelection());this.setState({editorState:x});},insertEmoji:function v(w){var x=c('EmojiFormat').codeArrayToUnicode(w);if(!p){this.setState({fallbackText:this.state.fallbackText+' '+x});return;}j(x,this.state.editorState,this._onChange);},_informHeightChange:function v(){if(this.props.monitorHeight)c('setImmediate')(function(){if(!this.isMounted())return;var w=p?c('ReactDOM').findDOMNode(this.refs.mentionsInput):c('ReactDOM').findDOMNode(this.refs.textarea),x=c('DOMVector').getElementDimensions(w).y;if(x!==this._height){this._height=x;c('Arbiter').inform(c('UFIUIEvents').InputHeightChanged,{node:w});}}.bind(this));},_onChange:function v(w){if(this.props.onContentChange){var x=this.state.editorState.getCurrentContent(),y=w.getCurrentContent();if(x!==y)this.props.onContentChange(c('getMentionsTextForContentState')(y));}this.setState({editorState:w},this._informHeightChange);},_clearDocumentState:function v(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var w=c('EditorState').createEmpty(c('getMentionsInputDecorator')());this.setState({editorState:c('EditorState').moveFocusToEnd(w)});},_handleContentReturn:function v(w){if(c('isSoftNewlineEvent')(w)){this.setState(function(x){var y=x.editorState;return {editorState:c('handleSoftNewlineForEmoticon')(y)};});return true;}w.persist();this.setState({},function(){if(this._submitComment(w))this._clearDocumentState();}.bind(this));return true;},_handleBeforeInput:function v(w){var x=c('handleBeforeInputForEmoticon')(this.state.editorState,w);if(x===this.state.editorState){return false;}else{this.setState({editorState:x});return true;}},_submitComment:function v(w){var x=this.state.editorState.getCurrentContent(),y=c('getVisibleValueForContentState')(x),z=c('getMentionsTextForContentState')(x),aa={visibleValue:y,encodedValue:z},ba=c('Input').getValue(c('ReactDOM').findDOMNode(this.refs.proxyInput));if(ba){var ca=new (c('URI'))(b.location.href);l.addNormal('path',ca.getPath());l.addNormal('proxy_value',ba.substr(0,m));l.post();}return this.props.onEnterSubmit(aa,w);},_handleFiles:function v(w){var x=s(w);if(x.length){this.props.onPaste(r(x));return true;}return false;},_handleDroppedFiles:function v(w,x){return this._handleFiles(x);},_handlePastedFiles:function v(w){return this._handleFiles(w);},_onMentionsInputBlur:function v(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();c('Arbiter').inform(c('UFIUIEvents').Blur,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID,hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function v(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;c('Bootloader').loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(w,x){if(!this.isMounted())return;var y=new w({event_name:'tinder_mentions'});y.sessionStart();var z=x(this.props.datasource,y,c('UFIConfig').showHashtagTypeahead);z.bootstrap();this.setState({typeaheadReporter:y,bootloaded:true,mentionsSource:z},function(){this._currentlyBootloading=false;}.bind(this));}.bind(this),'UFIMentionsInput.react');}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();c('Arbiter').inform(c('UFIUIEvents').Focus,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID});},_onShowMentions:function v(w,x){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(w.map(function(y){return y.getUniqueID();}));},_onAddMention:function v(w,x,y){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(w.getUniqueID(),w.getType(),x,y.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function v(w){if(w.which!==c('Keys').RETURN)return;if(c('isSoftNewlineEvent')(w)||!this.state.fallbackText.trim())return;w.preventDefault();var x={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(x,w))this.setState({fallbackText:''});},_onFallbackChange:function v(w){this.setState({fallbackText:w.target.value});},_onFallbackBlur:function v(w){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function v(w){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function v(w,x){var y=w.getAuxiliaryData().renderType,z=x.getAuxiliaryData().renderType;if(y===z)return w.getOrder()-x.getOrder();var aa=this.props.viewOptionsTypeObjectsOrder;return aa.indexOf(y)-aa.indexOf(z);},_triggerFullRender:function v(w){this.setState({fullRender:true},w);},_triggerFullRenderWithoutCallback:function v(){this._triggerFullRender();},_renderFallback:function v(){return (c('React').createElement('div',{className:"_2xwx"},c('React').createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9 _2xww",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function v(){if(!this.props.hideProxyInput){var w="_1osa mentionsHidden";return (c('React').createElement('input',{className:w,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function v(){var w="UFIAddCommentInput _1osb _1osc _2xww";return (c('React').createElement('div',{onClick:this._triggerFullRenderWithoutCallback,className:"_2xwx",onFocus:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback,onSelect:c('emptyFunction'),onTouchStart:this._triggerFullRenderWithoutCallback,role:'presentation'},this._renderProxyInput(),c('React').createElement('div',{className:w},this.props.placeholder)));},_onClickEditorContainer:function v(w){c('clickRefAction')('ufi',w.target,null,'FORCE');},_renderMentionsInput:function v(){var w="UFIAddCommentInput _1osb _2xww",x=babelHelpers['extends']({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (c('React').createElement('div',{className:"_2xwx",onClick:this._onClickEditorContainer,role:'presentation'},this._renderProxyInput(),c('React').createElement(k,{ref:'mentionsInput',className:w,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:x,spellCheck:true,showEmojiPicker:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,position:this.props.isBroadcasterUFI?'above':null,webDriverTestID:this.props.replyCommentID?o:n})));},componentDidMount:function v(){if(!p){if(this.state.fallbackText)c('ReactDOM').findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())c('setImmediate')(function(){this.isMounted()&&this.focus();}.bind(this));},render:function v(){if(!p)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function u(v){return c('DraftEntity').create('MENTION','IMMUTABLE',{id:v.uid,isWeak:v.weakreference});}f.exports=t;}),null);